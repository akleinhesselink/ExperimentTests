source('~/.active-rstudio-document', echo=TRUE)
head(z)
dim(x)
z = rmvnorm(time, c(0, 0), sigma)
z
N1
library(mvtnorm)
time <- 100
N1 <- rep(NA, time)
N2 <- rep(NA,time)
initialN <- 5
N1[1] <- initialN
N2[1] <- initialN
a11 <- 0.01
a12 <- 0.0001
a21 <- 0.02
a22 <- 0.012
Zvar <- 0.005
Zcov <- 0
sigma = matrix(data=c(Zvar, Zcov, Zcov, Zvar), nrow=2, ncol=2)
z = rmvnorm(time, c(0, 0), sigma)
head(z)
for(i in 2:time) {
N1[i] <- N1[i-1]+ N1[i-1](r[1]*N1[i-1]*(1-a11*N1[i-1]-a12*N2[i-1])+z[i-1, 1])
N2[i] <- N2[i-1]+ N2[i-1](r[2]*N2[i-1]*(1-a21*N1[i-1]-a22*N2[i-1])+z[i-1, 2])
}
i
head(n1)
N1
for(i in 2:time) {
N1[i] <- N1[i-1]+ N1[i-1]*(r[1]*N1[i-1]*(1-a11*N1[i-1]-a12*N2[i-1])+z[i-1, 1])
N2[i] <- N2[i-1]+ N2[i-1]*(r[2]*N2[i-1]*(1-a21*N1[i-1]-a22*N2[i-1])+z[i-1, 2])
}
plot(N1)
r
source('~/.active-rstudio-document', echo=TRUE)
plot(cbind(N1,N2))
plot(1:time,cbind(N1,N2))
N1
source('~/.active-rstudio-document', echo=TRUE)
N1
N2
matplot(c(1:time),cbind(N1,N2))
source('~/.active-rstudio-document', echo=TRUE)
# call all scripts for removal experiment analysis
rm(list=ls(all=TRUE))
graphics.off();
root=ifelse(.Platform$OS.type=="windows","c:/Repos","~/repos"); # modify as needed
setwd(paste(root,"/ExperimentTests/removals/",sep="")); # modify as needed
###
### 1. get treatment trends #################################
###
library(texreg) # to save output
library(lme4)
statsOutput <- paste0(getwd(),"/stats_tables.tex")
source("treatment_trends_removals.r")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
###
### 2. fit vital rate regressions ###########################
###
library(texreg) # to save output
library(xtable)
library(lme4)
library(INLA)
# table to store Treatment effects
trtTests <- data.frame("species"="c","stage"="c","effect"=1,"CI.02.5"=1,"CI.97.5"=1,stringsAsFactors = F)
# read in distance weights
dists <- read.csv(paste0(root,"/driversdata/data/idaho_modern/speciesdata/IdahoModDistanceWeights_noExptl.csv"))
###
### fit survival models (takes ~ 10 minutes)
###
setwd("survival")
source("write_params.r") # get function to format and output parameters
for(iSpp in c("ARTR","HECO","POSE","PSSP")){
source(paste0(iSpp,"survival.r"))
# save fixed effects summary to file
cat("",file=statsOutput,sep="\n",append=T)
cat(capture.output(print(xtable(m1$summary.fixed,digits=4,caption=paste("Summary of fixed effects for the",iSpp,"survival model"),
label=paste0(iSpp,"survival")),caption.placement="top")),file=statsOutput,sep="\n",append=T)
# save treatment test
irow <- dim(trtTests)[1]
trtTests[irow+1,] <- NA
trtTests[irow+1,1:2] <- c(iSpp,"survival")
tmp <- grep("Treatment",row.names(m1$summary.fixed))
trtTests[irow+1,3:5] <- m1$summary.fixed[tmp,c("mean","0.025quant","0.975quant")]
# write parameters
formatSurvPars(m1,paste0(iSpp,"_surv.csv"))
}
setwd("..")
###
### fit growth models (takes < 5 mins)
###
setwd("growth")
source("write_params.r") # get function to format and output parameters
for(iSpp in c("ARTR","HECO","POSE","PSSP")){
source(paste0(iSpp,"growth.r"))
# save fixed effects summary to file
cat("",file=statsOutput,sep="\n",append=T)
cat(capture.output(print(xtable(m1$summary.fixed,digits=4,caption=paste("Summary of fixed effects for the",iSpp,"growth model"),
label=paste0(iSpp,"growth")),caption.placement="top")),file=statsOutput,sep="\n",append=T)
# save treatment test
irow <- dim(trtTests)[1]
trtTests[irow+1,] <- NA
trtTests[irow+1,1:2] <- c(iSpp,"growth")
tmp <- grep("Treatment",row.names(m1$summary.fixed))
trtTests[irow+1,3:5] <- m1$summary.fixed[tmp,c("mean","0.025quant","0.975quant")]
# write parameters for best model
formatGrowthPars(m1,paste0(iSpp,"_growth.csv"))
}
setwd("..")
###
### fit recruitment models (this can take a few hours)
###
library(boot)
library(R2WinBUGS)
setwd("recruitment")
#source("call_recruit_m1.r")
# add treatment test data for ARTR
pars.summary <- read.csv("recruit_params_m1.csv")
irow <- dim(trtTests)[1]
trtTests[irow+1,] <- NA
trtTests[irow+1,1:2] <- c("ARTR","recruitment")
tmp <- grep("intcpt.trt",row.names(pars.summary))
trtTests[irow+1,3:5] <- pars.summary[tmp[5],c("mean","X2.5.","X97.5.")]
# add treatment test data for the three grasses
irow <- dim(trtTests)[1]
trtTests[(irow+1):(irow+3),] <- NA
trtTests[(irow+1):(irow+3),1:2] <- cbind(c("HECO","POSE","PSSP"),rep("recruitment",3))
trtTests[(irow+1):(irow+3),3:5] <- pars.summary[tmp[2:4],c("mean","X2.5.","X97.5.")]
# create summary stats table
fixeffs <- c("intcpt.mu","intcpt.trt","dd","theta","u")
keep <- NULL
for(i in fixeffs){
keep <- c(keep,grep(i,row.names(pars.summary),fixed=TRUE))
}
keep <- keep[-c(5,10:12,33:44)]  # some editing
output <- pars.summary[keep,c(1:3,7:9)]
cat("",file=statsOutput,sep="\n",append=T)
cat(capture.output(print(xtable(output,digits=4,caption=paste("Summary of fixed effects for the recruitment model"),
label="table:recruitment"),caption.placement="top")),file=statsOutput,sep="\n",append=T)
setwd("..")
###
### write results to file
###
trtTests <- trtTests[-1,] # throw away first line junk
write.csv(trtTests,"treatment_test_results.csv",row.names=F)
# make treatment effect figure
source("treatment_test_figure.r")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
###
### 3. explore neighborhood composition ###################################
###
library("TeachingDemos") # for inset plots
library("quantreg")
source("Wdistrib/exploreSurvivalWs.R")
# clean up
tmp=ls() ; tmp=tmp[tmp!="root" & tmp!="statsOutput"]
rm(list=tmp)
LV2<- function(N,a12, a11,a21,a22, r,z) {
newN1=N[1]+N[1]*(r[1]*(1-a11*N[1]-a12*N[2])+z[1])
newN2=N[2]+N[2]*(r[2]*(1-a21*N[1]-a22*N[2])+z[2])
return (c(newN1,newN2))
}
library(mvtnorm)
r=c(0.05,0.05)
a12=1
a11=1
a21=1
a22=1
Zvar = .02
Zcov= 0
Time = 5000
N=matrix(NA, nrow=Time, ncol=2)
N[1,1]=5
N[1,2]=5
sigma=matrix(data=c(Zvar,Zcov,Zcov, Zvar),nrow=2,ncol=2)
sigma
z_oi = rmvnorm(Time,c(0,0),sigma)
plot(z_oi)
source('~/.active-rstudio-document', echo=TRUE)
warnings()
sqrt(0)
simga
sigma
z_oi = rmvnorm(Time,c(0,0),sigma)
dat <- read.csv("/../../driversdata/data/idaho_modern/climateData/monthly_climate_from_daily.csv")
getwd()
setwd("/../../driversdata/data/idaho_modern/climateData")
setwd("../../driversdata/data/idaho_modern/climateData")
setwd(paste(root,"/ExperimentTests/removals/",sep="")); # modify as needed
dat <- read.csv("../../driversdata/data/idaho_modern/climateData/monthly_climate_from_daily.csv")
head(dat)
dat$climYr <- ifelse(dat$month>9,dat$year+1,dat$year)
View(dat)
meanClim <- aggregate(dat[,c("TMEAN","TPPT")],by=list(dat$climYr),FUN="mean")
meanClim
annualClim <- aggregate(dat[,c("TMEAN","TPPT")],by=list(dat$climYr),FUN="mean")
means <- colMeans(annualClim[,2:3])
means
means <- colMeans(annualClim[,2:3],na.rm = T)
means
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
meanPpt <- mean(annualPpt[,2],na.rm=T)
meanPpt
ppt.90 <- quantiles(annualPpt,c(0.05,0.95))
ppt.90 <- quantile(annualPpt,c(0.05,0.95))
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
ppt.90
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")*10
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
meanPpt
ppt.90
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")*25.4 # sum to year and convert to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
meanPpt
ppt.90
View(dat)
annualTemp <- (aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="sum")-32)*5/9 # average to year and convert to C
meanTemp <- mean(annualTemp[,2],na.rm=T)
temp.90 <- quantile(annualTemp[,2],c(0.05,0.95))
annualTemp <- (aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="sum")-32)*5/9 # average to year and convert to C
annualTemp
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
annualPpt[,2] <- annualPpt[,2]*25.4 # convert in to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
annualPpt
dat <- read.csv("../../driversdata/data/idaho_modern/climateData/monthly_climate_from_daily.csv")
dat$climYr <- ifelse(dat$month>9,dat$year+1,dat$year)
dat <- subset(dat,climYr>1926) # remove incomplete year
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
annualPpt[,2] <- annualPpt[,2]*25.4 # convert in to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
annualTemp <- aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="sum")
annualTemp[,2] <- (annualTemp[,2]-32)*5/9 # convert F to C
meanTemp <- mean(annualTemp[,2],na.rm=T)
temp.90 <- quantile(annualTemp[,2],c(0.05,0.95))
annualTemp
temp.90 <- quantile(meanTemp[,2],c(0.05,0.95))
dat <- read.csv("../../driversdata/data/idaho_modern/climateData/monthly_climate_from_daily.csv")
dat$climYr <- ifelse(dat$month>9,dat$year+1,dat$year)
dat <- subset(dat,climYr>1926) # remove incomplete year
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
annualPpt[,2] <- annualPpt[,2]*25.4 # convert in to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
annualTemp <- aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="sum")
View(annualTemp)
annualTemp <- aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="mean")
annualTemp[,2] <- (annualTemp[,2]-32)*5/9 # convert F to C
meanTemp <- mean(annualTemp[,2],na.rm=T)
meanTemp
temp.90 <- quantile(annualTemp[,2],c(0.05,0.95))
temp.90 <- quantile(annualTemp[,2],c(0.05,0.95),na.rm=T)
tmp.90
temp.90
modernPpt <- subset(meanPpt,climYr>2010)
head(annualPpt)
source('C:/Repos/ExperimentTests/removals/climate_fig.r', echo=TRUE)
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
names(annualPpt) <- c("climYr","precip")
annualPpt[,2] <- annualPpt[,2]*25.4 # convert in to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
head(annualPpt)
modernPpt <- subset(annualPpt,climYr>2010)
modernPpt
plot(modernPpt)
plot(modernPpt,type="o",pch=16)
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16)
ppt.90
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=2)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1)
abline(h=ppt.90[2],col="dodgerblue3",lwd=1)
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=2)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
plot(modernTemp,type="o",pch=16,ylim=c(3,10),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
modernTemp
dat <- read.csv("../../driversdata/data/idaho_modern/climateData/monthly_climate_from_daily.csv")
dat$climYr <- ifelse(dat$month>9,dat$year+1,dat$year)
dat <- subset(dat,climYr>1926) # remove incomplete year
annualPpt <- aggregate(dat[,c("TPPT")],by=list(dat$climYr),FUN="sum")
names(annualPpt) <- c("climYr","precip")
annualPpt[,2] <- annualPpt[,2]*25.4 # convert in to mm
meanPpt <- mean(annualPpt[,2],na.rm=T)
ppt.90 <- quantile(annualPpt[,2],c(0.05,0.95))
modernPpt <- subset(annualPpt,climYr>2010)
annualTemp <- aggregate(dat[,c("TMEAN")],by=list(dat$climYr),FUN="mean")
names(annualTemp) <- c("climYr","temperature")
annualTemp[,2] <- (annualTemp[,2]-32)*5/9 # convert F to C
meanTemp <- mean(annualTemp[,2],na.rm=T)
temp.90 <- quantile(annualTemp[,2],c(0.05,0.95),na.rm=T)
modernTemp <- subset(annualTemp,climYr>2010)
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
plot(modernTemp,type="o",pch=16,ylim=c(3,10),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,1,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
plot(modernTemp,type="o",pch=16,ylim=c(4,9.5),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,3,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
mtext("(a)",side=3,line=1)
plot(modernTemp,type="o",pch=16,ylim=c(4,9.5),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
mtext("(b)",side=3,line=1)
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,3,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
mtext("(a)",side=3,line=0.5,adj=1)
plot(modernTemp,type="o",pch=16,ylim=c(4,9.5),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
mtext("(b)",side=3,line=0.5,adj=1)
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,3,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
mtext("(a)",side=3,line=0.5,adj=3)
plot(modernTemp,type="o",pch=16,ylim=c(4,9.5),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
mtext("(b)",side=3,line=0.5,adj=3)
# make figure
par(mfrow=c(1,2),tcl=-0.2,mgp=c(2,0.5,0),mar=c(3,4,3,1))
plot(modernPpt,type="o",pch=16,ylim=c(150,500),xlab="Year",ylab="Annual precipitation (mm)")
abline(h=meanPpt,col="dodgerblue3",lwd=1)
abline(h=ppt.90[1],col="dodgerblue3",lwd=1,lty="dashed")
abline(h=ppt.90[2],col="dodgerblue3",lwd=1,lty="dashed")
mtext("(a)",side=3,line=0.5,adj=0)
plot(modernTemp,type="o",pch=16,ylim=c(4,9.5),xlab="Year",ylab="Mean temperature (C)")
abline(h=meanTemp,col="red3",lwd=1)
abline(h=temp.90[1],col="red3",lwd=1,lty="dashed")
abline(h=temp.90[2],col="red3",lwd=1,lty="dashed")
mtext("(b)",side=3,line=0.5,adj=0)
source('C:/Repos/ExperimentTests/removals/climate_fig.r', echo=TRUE)
source('C:/Repos/ExperimentTests/removals/climate_fig.r', echo=TRUE)
rm(list=ls(all=TRUE))
graphics.off();
root=ifelse(.Platform$OS.type=="windows","c:/Repos","~/repos"); # modify as needed
setwd(paste(root,"/ExperimentTests/removals/",sep="")); # modify as needed
source("climate_fig.r")
source('C:/temp/ResRatio_2spp_demo.r', echo=TRUE)
warnings()
